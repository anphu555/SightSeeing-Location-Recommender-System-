<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sigma-Alpha Sightseeing</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="overlay">
      <div class="logo">
        <img src="images/tuyu.png" alt="Logo" />
        <h1>SIGMA-ALPHA SIGHTSEEING</h1>
      </div>

      <div class="search-bar">
        <input type="text" placeholder="Search locations..." />
        <button>Search</button>
      </div>
    </div>
  </header>

  <!-- Results Section -->
  <main class="results-section">
    <div class="results-header">
      <h2>3 results</h2>
      <select>
        <option>Sort by: Price</option>
        <option>Sort by: Name</option>
        <option>Sort by: Rating</option>
      </select>
    </div>

    <div class="cards">
      <div class="card">
        <img src="images/tuyu.png" alt="Ha Long Bay" />
        <p>HA LONG BAY</p>
      </div>

      <div class="card">
        <img src="images/tuyu.png" alt="Tuan Chau Park" />
        <p>TUAN CHAU PARK</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>
      
      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>

      <div class="card">
        <img src="images/yentu.jpg" alt="Yen Tu Mountain" />
        <p>YEN TU MOUNTAIN</p>
      </div>
      
    </div>
  </main>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const apiBase = 'http://127.0.0.1:8000';
  const params  = new URLSearchParams(location.search);
  const text    = (params.get('text') || '').trim();
  const k       = Number(params.get('k') || '6');

  const headerH2 = document.querySelector('.results-header h2') || (()=>{
    const wrap = document.createElement('div');
    wrap.className = 'results-header';
    wrap.innerHTML = '<h2>Results</h2>';
    document.body.prepend(wrap);
    return wrap.querySelector('h2');
  })();

  const cards = document.querySelector('.cards') || (()=>{
    const div = document.createElement('div');
    div.className = 'cards';
    document.body.appendChild(div);
    return div;
  })();

  function renderCard(item){
    const div = document.createElement('div');
    div.className = 'card';
    const img = document.createElement('img');
    img.src = 'images/halong.jpg'; // táº¡m áº£nh máº«u; Ä‘á»•i theo data náº¿u muá»‘n
    img.alt = item.name;
    const name = document.createElement('p'); name.textContent = item.name;
    const meta = document.createElement('p');
    meta.style.fontWeight='normal'; meta.style.color='#666'; meta.style.paddingBottom='12px';
    meta.textContent = `${item.province ?? ''} â€¢ ${item.region ?? ''} â€¢ score ${item.score}`;
    div.append(img, name, meta);
    return div;
  }

  async function run(){
    if(!text){ headerH2.textContent='0 results'; return; }
    headerH2.textContent = 'Loading...'; cards.innerHTML='';
    try{
      const r = await fetch(`${apiBase}/api/v1/recommend`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ user_text: text, top_k: k })
      });
      if(!r.ok){
        let err = await r.text(); throw new Error(err || `HTTP ${r.status}`);
      }
      const data = await r.json();
      const items = data.results || [];
      headerH2.textContent = `${items.length} results`;
      items.forEach(it => cards.appendChild(renderCard(it)));
    }catch(e){
      headerH2.textContent = 'Error';
      cards.innerHTML = `<div style="padding:12px;color:#b00">${e.message}</div>`;
      console.error(e);
    }
  }
  const headerInput = document.querySelector('.search-bar input');
  const headerBtn   = document.querySelector('.search-bar button');

  // (tuá»³ thÃ­ch) Ä‘á»• láº¡i giÃ¡ trá»‹ Ä‘ang cÃ³ trÃªn URL vÃ o Ã´ search Ä‘á»ƒ tiá»‡n sá»­a
  if (headerInput) headerInput.value = (new URLSearchParams(location.search).get('text') || '');

  // 2) HÃ m kÃ­ch hoáº¡t tÃ¬m kiáº¿m má»›i
  function triggerSearch() {
    const q = (headerInput?.value || '').trim();
    if (!q) return;

    // CÃ¡ch A (Ä‘Æ¡n giáº£n nháº¥t): Ä‘á»•i URL params rá»“i reload Ä‘Ãºng chuáº©n
    const params = new URLSearchParams(location.search);
    params.set('text', q);
    params.set('k', params.get('k') || '6');
    window.location.search = params.toString();

    // CÃ¡ch B (khÃ´ng reload trang): gá»i láº¡i hÃ m fetch hiá»‡n cÃ³
    // ðŸ‘‰ Náº¿u báº¡n muá»‘n dÃ¹ng cÃ¡ch B, báº¡n cáº§n biáº¿n `text` thÃ nh biáº¿n cÃ³ thá»ƒ gÃ¡n láº¡i,
    //    vÃ  tÃ¡ch fetch ra thÃ nh hÃ m `fetchAndRender(q, k)`. á»ž Ä‘Ã¢y mÃ¬nh giá»¯ cÃ¡ch A cho gá»n.
  }

  // 3) Gáº¯n sá»± kiá»‡n click + Enter
  headerBtn?.addEventListener('click', triggerSearch);
  headerInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') triggerSearch();
  });

  console.log('Params:', {text, k});
  run();
});
</script>

</body>
</html>
