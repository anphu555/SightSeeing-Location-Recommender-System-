<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exSighting - Khám Phá Địa Điểm</title>
    <link rel="stylesheet" href="style.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="navbar-v3">
        <div class="logo">
            <i class="fas fa-umbrella"></i>
            <span>exSighting</span>
        </div>
        <nav class="nav-links">
            <a href="#" class="nav-item">Contact</a>
            <a href="#" class="nav-item">About us</a>
        </nav>
        <div id="userAuthTemplate">
    
    <button class="user-actions-unsigned-in" id="unsignedInBlock">
        <div class="user-icon-bg">
            <i class="fas fa-user-circle"></i>
        </div>
        <span class="sign-in-text">Sign In</span>
    </button>

    <div class="user-actions-signed-in" id="signedInBlock" style="display: none;">
        
        <button class="user-profile-toggle">
            <div class="user-icon-bg">
                <i class="fas fa-user-circle"></i>
            </div>
            <span class="username-text" id="currentUser"></span>
            <i class="fas fa-caret-down"></i>
        </button>
        
        <div class="user-dropdown-menu">
            <a href="#">Profile</a>
            <a href="#">Settings</a>
            <a href="#">Manage Billing</a>
            <a href="#">Log Out</a>
        </div>
    </div>
</div>
    </header>

    <main>
        <section class="hero-banner">
            
            <div class="banner-slider" id="bannerSlider"></div>

            <div class="overlay"></div>

            <div class="search-container">
                <h1>What type of place would you like to go?</h1>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="For example: the mountains, the beaches,...">
                    <button onclick="goToResults()"><i class="fas fa-search"></i></button>
                </div>
            </div>

            <div class="dots-container" id="bannerDots"></div>
        </section>

        <section class="popular-places-section">
            <h2 class="section-title">Popular Places</h2>

            <div class="places-carousel">
                <button class="arrow-btn prev-btn" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
                
                <div class="carousel-viewport">
                    <div class="place-card-list" id="placeCardList">
                        </div>
                </div>

                <button class="arrow-btn next-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <button class="view-all-btn">View All</button>
        </section>
    </main>

    <script>
        // Hàm chuyển trang tìm kiếm
        function goToResults() {
            const query = document.getElementById('searchInput').value;
            if(query.trim() !== "") {
                window.location.href = `results.html?q=${encodeURIComponent(query)}`;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            
            // ============================================================
            // PHẦN 1: HERO BANNER (DỮ LIỆU ĐỘNG TỪ DB)
            // ============================================================
            
            // Giả lập dữ liệu trả về từ Database (Bạn có thể thêm bao nhiêu ảnh tùy thích)
            const bannerData = [
                { id: 1, img: "https://images.unsplash.com/photo-1528127269322-539801943592?q=80&w=2070&auto=format&fit=crop" },
                { id: 2, img: "https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?q=80&w=2070&auto=format&fit=crop" },
                { id: 3, img: "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=2070&auto=format&fit=crop" }
            ];

            const bannerContainer = document.getElementById('bannerSlider');
            const dotsContainer = document.getElementById('bannerDots');
            let currentSlide = 0;
            const slideIntervalTime = 7000; // 7 giây

            // Hàm Render Banner HTML
            function renderBannerSystem(data) {
                // 1. Render Slides
                bannerContainer.innerHTML = data.map((item, index) => `
                    <div class="slide ${index === 0 ? 'active' : ''}" 
                         style="background-image: url('${item.img}');"
                         data-index="${index}">
                    </div>
                `).join('');

                // 2. Render Dots (Số lượng dot = số lượng ảnh)
                dotsContainer.innerHTML = data.map((_, index) => `
                    <span class="dot ${index === 0 ? 'active' : ''}" data-index="${index}"></span>
                `).join('');
                
                // 3. Khởi động logic chạy slide sau khi đã có HTML
                initBannerAnimation();
            }

            // Hàm Logic chạy Slide
            function initBannerAnimation() {
                const slides = document.querySelectorAll('.slide');
                const dots = document.querySelectorAll('.dot');

                function nextBannerSlide() {
                    const previousSlide = slides[currentSlide];
                    currentSlide = (currentSlide + 1) % slides.length;
                    const nextSlideEl = slides[currentSlide];

                    // Hiệu ứng trượt
                    previousSlide.classList.remove('active');
                    previousSlide.classList.add('leave');

                    nextSlideEl.classList.add('active');
                    nextSlideEl.classList.remove('leave');

                    // Cập nhật Dots
                    dots.forEach(d => d.classList.remove('active'));
                    dots[currentSlide].classList.add('active');

                    // Dọn dẹp class leave
                    setTimeout(() => {
                        previousSlide.classList.remove('leave');
                    }, 1000);
                }

                // Chạy tự động
                let slideInterval = setInterval(nextBannerSlide, slideIntervalTime);

                // Sự kiện click vào Dot để chuyển slide nhanh
                dots.forEach(dot => {
                    dot.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        if (index === currentSlide) return;

                        // Reset Interval để không bị loạn
                        clearInterval(slideInterval);
                        
                        // Xóa trạng thái cũ
                        slides[currentSlide].classList.remove('active');
                        slides[currentSlide].classList.remove('leave');
                        
                        // Cập nhật vị trí mới
                        currentSlide = index;
                        
                        // Set trạng thái mới
                        slides[currentSlide].classList.add('active');
                        
                        // Cập nhật dots
                        dots.forEach(d => d.classList.remove('active'));
                        dots[currentSlide].classList.add('active');

                        // Chạy lại timer
                        slideInterval = setInterval(nextBannerSlide, slideIntervalTime);
                    });
                });
            }

            // --- GỌI HÀM RENDER BANNER ---
            // Sau này thay bằng: fetch('/api/banners').then(res=>res.json()).then(data=>renderBannerSystem(data));
            renderBannerSystem(bannerData);


            // ============================================================
            // PHẦN 2: POPULAR PLACES (DỮ LIỆU ĐỘNG TỪ DB)
            // ============================================================
            
            const placeData = [
                { name: "HA LONG BAY", img: "https://images.unsplash.com/photo-1528127269322-539801943592?q=80&w=2070&auto=format&fit=crop", cost: "Medium", weather: "Cool", crowd: "Medium" },
                { name: "NHA TRANG BEACH", img: "https://images.unsplash.com/photo-1565691668615-5e60d5c08611?q=80&w=2070&auto=format&fit=crop", cost: "Low", weather: "Hot", crowd: "High" },
                { name: "SAPA MOUNTAINS", img: "https://images.unsplash.com/photo-1599229062397-6c8418047918?q=80&w=2070&auto=format&fit=crop", cost: "Low", weather: "Cool", crowd: "Medium" },
                { name: "DA LAT", img: "https://images.unsplash.com/photo-1596328372690-e9b46571b402?q=80&w=2070&auto=format&fit=crop", cost: "Medium", weather: "Chilly", crowd: "Medium" },
                { name: "PHU QUOC", img: "https://images.unsplash.com/photo-1592350849318-7b9c9f2b879a?q=80&w=1974&auto=format&fit=crop", cost: "High", weather: "Warm", crowd: "Low" },
                { name: "HUE CITY", img: "https://images.unsplash.com/photo-1583486337220-333e882200be?q=80&w=1974&auto=format&fit=crop", cost: "Low", weather: "Varies", crowd: "Medium" },
                { name: "HOI AN", img: "https://images.unsplash.com/photo-1557750255-c76072a7aad1?q=80&w=2070&auto=format&fit=crop", cost: "Medium", weather: "Warm", crowd: "High" },
                { name: "NINH BINH", img: "https://images.unsplash.com/photo-1616639535315-998813a45c36?q=80&w=1974&auto=format&fit=crop", cost: "Low", weather: "Cool", crowd: "Low" },
                { name: "VUNG TAU", img: "https://images.unsplash.com/photo-1558611689-d64e83058814?q=80&w=2070&auto=format&fit=crop", cost: "Low", weather: "Hot", crowd: "High" },
            ];

            const cardList = document.getElementById('placeCardList');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            const CARD_WIDTH = 250; 
            const CARD_GAP = 30; 
            const CARDS_PER_VIEW = 3; 
            const SLIDE_DISTANCE = (CARD_WIDTH + CARD_GAP) * CARDS_PER_VIEW;
            const MAX_STEPS = Math.ceil(placeData.length / CARDS_PER_VIEW) - 1; 
            let currentStep = 0;

            function createPlaceCard(data) {
                return `
                    <div class="place-card">
                        <img src="${data.img}" alt="${data.name}" class="card-image">
                        <div class="card-name-overlay">
                            <h3>${data.name}</h3>
                        </div>
                        <div class="card-content-wrapper">
                            <div class="card-content">
                                <p><strong>Cost:</strong> ${data.cost}</p>
                                <p><strong>Weather:</strong> ${data.weather}</p>
                                <p><strong>Crowd:</strong> ${data.crowd}</p>
                                <button class="explore-btn">Explore Now!</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            function updateCarousel() {
                const offset = currentStep * SLIDE_DISTANCE;
                cardList.style.transform = `translateX(-${offset}px)`;
            }
            
            // --- GỌI HÀM RENDER PLACES ---
            // Sau này thay bằng: fetch('/api/places').then(res=>res.json()).then(data=> ... );
            cardList.innerHTML = placeData.map(createPlaceCard).join('');
            
            // Event Listeners
            nextBtn.addEventListener('click', () => {
                if (currentStep < MAX_STEPS) { currentStep++; } else { currentStep = 0; }
                updateCarousel();
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 0) { currentStep--; } else { currentStep = MAX_STEPS; }
                updateCarousel();
            });
        });

        // --- BỔ SUNG: LOGIC TÌM KIẾM BẰNG PHÍM ENTER (TRONG INDEX.HTML) ---

// Lắng nghe sự kiện DOMContentLoaded để đảm bảo các phần tử đã tải xong
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');

    // Thêm sự kiện bắt phím
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            // Kiểm tra nếu phím Enter (keyCode 13 hoặc key 'Enter') được nhấn
            if (e.key === 'Enter') {
                e.preventDefault(); // Ngăn hành động mặc định của trình duyệt
                goToResults(); // Gọi hàm tìm kiếm đã có
            }
        });
    }

    // Các logic khác của trang chủ (Slider, Carousel) giữ nguyên ở đây...
    // ...
});
// Lưu ý: Đảm bảo hàm goToResults() đã được định nghĩa và hoạt động đúng.

// --- TEMPLATE LOGIC: KIỂM SOÁT TRẠNG THÁI ĐĂNG NHẬP ---

/**
 * Hàm cập nhật giao diện dựa trên trạng thái đăng nhập
 * @param {string} username - Tên người dùng trả về từ DB
 * @param {boolean} isLoggedIn - Cờ trạng thái (true/false)
 */
function updateAuthUI(username, isLoggedIn) {
    const unsignedBlock = document.getElementById('unsignedInBlock');
    const signedInBlock = document.getElementById('signedInBlock');
    const usernameDisplay = document.getElementById('currentUser');

    if (isLoggedIn && username) {
        // 1. Nếu ĐÃ đăng nhập: Hiện khối Signed In
        usernameDisplay.textContent = username;
        signedInBlock.style.display = 'flex'; // Dùng flex để phù hợp với CSS
        unsignedBlock.style.display = 'none';
    } else {
        // 2. Nếu CHƯA đăng nhập: Hiện khối Sign In
        signedInBlock.style.display = 'none';
        unsignedBlock.style.display = 'block'; 
    }
}

// Ví dụ mô phỏng việc kiểm tra trạng thái ngay khi trang tải xong:
// 
// SAU NÀY, Backend sẽ thay thế phần này bằng: 
// fetch('/api/user-status').then(res => res.json()).then(data => {
//     updateAuthUI(data.username, data.isAuthenticated);
// });

// --- VÍ DỤ TEST ---

// TEST 1: Hiển thị trạng thái ĐÃ đăng nhập với tên "Phạm Khánh"
// updateAuthUI('Phạm Khánh', true); 

// TEST 2: Hiển thị trạng thái CHƯA đăng nhập
// updateAuthUI(null, false);
    </script>
</body>
</html>