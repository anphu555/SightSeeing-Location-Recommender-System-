<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm - exSighting</title>
    <link rel="stylesheet" href="style.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="navbar-v3">
        <div class="logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
            <i class="fas fa-umbrella"></i>
            <span>exSighting</span>
        </div>
        <nav class="nav-links">
            <a href="#" class="nav-item">Contact</a>
            <a href="#" class="nav-item">About us</a>
        </nav>
        
        <div id="userAuthTemplate">
            <button class="user-actions-unsigned-in" id="unsignedInBlock">
                <div class="user-icon-bg"><i class="fas fa-user-circle"></i></div>
                <span class="sign-in-text">Sign In</span>
            </button>

            <div class="user-actions-signed-in" id="signedInBlock" style="display: none;">
                <button class="user-profile-toggle">
                    <div class="user-icon-bg"><i class="fas fa-user-circle"></i></div>
                    <span class="username-text" id="currentUser"></span>
                    <i class="fas fa-caret-down"></i>
                </button>
                <div class="user-dropdown-menu">
                    <a href="#">Profile</a>
                    <a href="#">Settings</a>
                    <a href="#">Log Out</a>
                </div>
            </div>
        </div>
    </header>

    <section class="hero-banner" style="background-image: url('https://images.unsplash.com/photo-1528127269322-539801943592?q=80&w=2070&auto=format&fit=crop');"> 
        <div class="overlay"></div>
        <div class="search-container">
            <h1>What type of place would you like to go?</h1>
            <div class="search-box">
                <input type="text" id="resultsPageInput" placeholder="For example: the mountains, the beaches,...">
                <button id="resultsPageSearchBtn"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </section>
    
    <main class="results-page-wrapper">
        <div class="results-container">
            
            <div class="results-toolbar">
                <h3 class="result-count"><span id="totalCount">0</span> results</h3>
                
                <div class="custom-sort-dropdown" id="customSort">
                    <div class="sort-trigger">
                        <span class="sort-label">Sort by:</span>
                        <span class="sort-value" id="currentSortValue">Newest</span>
                        <i class="fas fa-chevron-down arrow-icon"></i>
                    </div>
                    <ul class="sort-options">
                        <li class="sort-option active" data-value="newest"><i class="fas fa-clock"></i> Newest</li>
                        <div class="divider"></div>
                        <li class="sort-option" data-value="price"><i class="fas fa-tag"></i> Price</li>
                        <div class="divider"></div>
                        <li class="sort-option" data-value="views"><i class="fas fa-eye"></i> Most Viewed</li>
                    </ul>
                    <input type="hidden" id="sortSelectHidden" value="newest">
                </div>
            </div>

            <div class="results-grid" id="resultsGrid">
                </div>

        </div>
    </main>

    <script>
        /* --- 1. DATA GIẢ LẬP (DATABASE) --- */
        const dbResponse = [
            // Dữ liệu tìm kiếm thông thường
            { id: 1, title: "Gai Nhat de thuong", subtitle: "Thanh Hoa", views: 252, image: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=2070&auto=format&fit=crop" },
            { id: 2, title: "Gai Nhat dang yeu", subtitle: "Hai Phong", views: 500, image: "https://images.unsplash.com/photo-1620409923832-15f7d23d9a0d?q=80&w=1974&auto=format&fit=crop" },
            { id: 3, title: "Gai Nhat Dam Dang", subtitle: "Ha Noi", views: 120, image: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=1887&auto=format&fit=crop" },
            { id: 4, title: "Co gai Da Lat", subtitle: "Lam Dong", views: 890, image: "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=1887&auto=format&fit=crop" },
            { id: 5, title: "Thieu nu Hue", subtitle: "Hue", views: 340, image: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1887&auto=format&fit=crop" },

            // Dữ liệu Popular Places (Có type='popular')
            { id: 101, title: "HA LONG BAY", subtitle: "Quang Ninh", views: 999, image: "https://images.unsplash.com/photo-1528127269322-539801943592?q=80&w=2070&auto=format&fit=crop", type: "popular" },
            { id: 102, title: "NHA TRANG BEACH", subtitle: "Khanh Hoa", views: 850, image: "https://images.unsplash.com/photo-1565691668615-5e60d5c08611?q=80&w=2070&auto=format&fit=crop", type: "popular" },
            { id: 103, title: "SAPA MOUNTAINS", subtitle: "Lao Cai", views: 720, image: "https://images.unsplash.com/photo-1599229062397-6c8418047918?q=80&w=2070&auto=format&fit=crop", type: "popular" },
            { id: 104, title: "DA LAT", subtitle: "Lam Dong", views: 680, image: "https://images.unsplash.com/photo-1596328372690-e9b46571b402?q=80&w=2070&auto=format&fit=crop", type: "popular" },
            { id: 105, title: "PHU QUOC", subtitle: "Kien Giang", views: 900, image: "https://images.unsplash.com/photo-1592350849318-7b9c9f2b879a?q=80&w=1974&auto=format&fit=crop", type: "popular" },
            { id: 106, title: "HUE CITY", subtitle: "Thua Thien Hue", views: 540, image: "https://images.unsplash.com/photo-1583486337220-333e882200be?q=80&w=1974&auto=format&fit=crop", type: "popular" },
            { id: 107, title: "HOI AN", subtitle: "Quang Nam", views: 810, image: "https://images.unsplash.com/photo-1557750255-c76072a7aad1?q=80&w=2070&auto=format&fit=crop", type: "popular" },
            { id: 108, title: "NINH BINH", subtitle: "Ninh Binh", views: 430, image: "https://images.unsplash.com/photo-1616639535315-998813a45c36?q=80&w=1974&auto=format&fit=crop", type: "popular" },
            { id: 109, title: "VUNG TAU", subtitle: "Ba Ria", views: 300, image: "https://images.unsplash.com/photo-1558611689-d64e83058814?q=80&w=2070&auto=format&fit=crop", type: "popular" },
        ];

        // --- 2. CÁC HÀM XỬ LÝ (CORE FUNCTIONS) ---

        // Lấy tham số từ URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Tạo HTML thẻ Card
        function createCardHTML(item) {
            return `
                <div class="result-card">
                    <div class="card-img-top">
                        <img src="${item.image}" alt="${item.title}">
                        <div class="view-badge">
                            <i class="fas fa-eye"></i> ${item.views}
                        </div>
                    </div>
                    <div class="card-body">
                        <h4 class="card-title">${item.title}</h4>
                        <p class="card-subtitle">${item.subtitle}</p>
                    </div>
                    <div class="card-footer">
                        <button class="icon-action like-btn"><i class="fas fa-thumbs-up"></i></button>
                        <button class="icon-action dislike-btn"><i class="fas fa-thumbs-down"></i></button>
                    </div>
                </div>
            `;
        }

        // Render dữ liệu ra màn hình
        function renderPage(data) {
            const grid = document.getElementById('resultsGrid');
            const counter = document.getElementById('totalCount');
            
            counter.innerText = data.length;

            if (data.length > 0) {
                grid.innerHTML = data.map(item => createCardHTML(item)).join('');
            } else {
                grid.innerHTML = '<p class="no-result" style="width:100%; text-align:center; padding: 20px;">No results found.</p>';
            }
        }

        // Logic tìm kiếm (Filter)
        function performSearch(keyword) {
            const keywordTrimmed = keyword ? keyword.toLowerCase().trim() : '';
            const filteredData = dbResponse.filter(item => {
                return item.title.toLowerCase().includes(keywordTrimmed) || 
                       item.subtitle.toLowerCase().includes(keywordTrimmed);
            });
            renderPage(filteredData);
        }

        // Hàm cập nhật UI User (Template cho Backend dùng)
        function updateAuthUI(username, isLoggedIn) {
            const unsignedBlock = document.getElementById('unsignedInBlock');
            const signedInBlock = document.getElementById('signedInBlock');
            const usernameDisplay = document.getElementById('currentUser');

            if (isLoggedIn && username) {
                usernameDisplay.textContent = username;
                signedInBlock.style.display = 'flex';
                unsignedBlock.style.display = 'none';
            } else {
                signedInBlock.style.display = 'none';
                unsignedBlock.style.display = 'flex'; 
            }
        }

        // --- 3. KHỞI CHẠY (INITIALIZATION) ---
        document.addEventListener('DOMContentLoaded', () => {
            const mode = getQueryParam('mode');
            const query = getQueryParam('q');
            const searchInput = document.getElementById('resultsPageInput');
            const searchBtn = document.getElementById('resultsPageSearchBtn');

            // --- A. XỬ LÝ LOGIC HIỂN THỊ DỮ LIỆU ---
            if (mode === 'popular') {
                // Nếu là mode Popular -> Lọc item có type 'popular'
                const popularData = dbResponse.filter(item => item.type === 'popular');
                renderPage(popularData);
                // searchInput.value = "Popular Places"; // (Optional)
            } else if (query) {
                // Nếu có từ khóa tìm kiếm -> Lọc và điền vào ô input
                searchInput.value = query;
                performSearch(query);
            } else {
                // Mặc định -> Hiện tất cả
                renderPage(dbResponse);
            }

            // --- B. GẮN SỰ KIỆN TÌM KIẾM ---
            searchBtn.addEventListener('click', () => performSearch(searchInput.value));
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch(searchInput.value);
            });

            // --- C. LOGIC CUSTOM SORT DROPDOWN ---
            const dropdown = document.getElementById('customSort');
            const trigger = dropdown.querySelector('.sort-trigger');
            const options = dropdown.querySelectorAll('.sort-option');
            const currentValueDisplay = document.getElementById('currentSortValue');

            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('open');
            });

            options.forEach(option => {
                option.addEventListener('click', () => {
                    const text = option.innerText;
                    currentValueDisplay.innerText = text;
                    options.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    dropdown.classList.remove('open');
                    // Tại đây có thể gọi hàm sắp xếp lại dbResponse và renderPage()
                });
            });

            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
            });

            // --- D. TEST AUTH (Xóa dòng dưới khi nối Backend) ---
            // updateAuthUI('sigma', true); 
        });
    </script>
</body>
</html>